<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../d2l-colors/d2l-colors.html">

<dom-module id="d2l-file-uploader">

	<template>
		<style>
			#drop_zone {
				border: 2px dashed;
				border-radius: 6px;
				text-align: center;
				height: 9rem;
				width: 27rem;
				max-width: 27rem;
			}

			:host([file-drag-over]) #drop_zone {
        		color: var(--d2l-color-celestine);
				background-color: var(--d2l-color-celestine-light-1);
      		}

			#file_upload_icon {
				padding-top: 1.5rem;
				padding-bottom: 0.6rem;
			}

			#file_upload_icon::before {
				content: url('uploadlarge.svg');
			}

			:host([file-drag-over]) #file_upload_icon::before {
				fill: red;
			}
			
			d2l-icon#file_upload_icon {
				--d2l-icon-height: 3rem;
				--d2l-icon-width: 3rem;
			}

			#file_upload_input {
				/*width: 0.1px;
				height: 0.1px;*/
				opacity: 0;
				overflow: hidden;
				position: absolute;
				/*z-index: -1;*/
			}

			#browse_label {
				position: relative;
				overflow: hidden;
				padding-right: 0px;
				border: none;
				background: none;
				color: var(--d2l-color-celestine);
			}

			#browse_label:hover, #file_upload_input:focus + label {
				color: var(--d2l-color-celestuba);;
				text-decoration: underline;
			}
		</style>

		<div id="drop_zone" on-drop="_fileDropHandler" on-dragover="_fileDragOverHandler" on-dragleave="_fileDragLeaveHandler" on-dragend="_fileDragEndHandler">
			<div id="file_upload_icon"></div>
			<div>
				<span>Drag and drop a file anywhere on this screen or 
				<input id="file_upload_input" type="file" multiple on-change="_fileSelectHandler"/>
				<label id="browse_label" for="file_upload_input">browse</label>.</span>
			</div>
		</div>
	</template>

	<script>
		Polymer({
			is: 'd2l-file-uploader',

			properties: {

				files: {
					type: Object,
					value: null,
					notify: true,
					observer: '_fileChangeHandler'
				},

				fileDragOver: {
					type: Boolean,
					value: false,
					notify: true,
					reflectToAttribute: true
				}

			},

			ready: function() {
				//this.setupDropArea();
				//this.setupFileSelect();
			},

			setupDropArea: function() {

			},

			_fileSelectHandler: function(event) {
				var files = [];
				for (var i = 0; i < event.target.files.length; i++) {
					files[i] = event.target.files[i];
				}

				this.files = files;
			},

			_fileDragOverHandler: function(event) {
				event.preventDefault();
				this.fileDragOver = true;
			},

			_fileDragLeaveHandler: function(event) {
				event.preventDefault();
				this.fileDragOver = false;
			},

			_fileDragEndHandler: function(event) {
				this.fileDragOver = false;
				var dataTransfer = event.dataTransfer;
				if (dataTransfer.items) {
					// Use DataTransferItemList interface to remove the drag data
					for (var i = 0; i < dataTransfer.items.length; i++) {
						dataTransfer.items.remove(i);
					}
				}
				else {
					// Use DataTransfer interface to remove the drag data
					event.dataTransfer.clearData();
				}
			},

			_fileDropHandler: function(event) {
				event.preventDefault();
				this.fileDragOver = false;				
				var files = [];
				var dataTransfer = event.dataTransfer;
				if (dataTransfer.items) {
					// Use DataTransferItemList interface to access the file(s)
					for (var i = 0; i < dataTransfer.items.length; i++) {
						if (dataTransfer.items[ i ].kind === 'file') {
							files[i] = dataTransfer.items[i].getAsFile();
						}
					}
				}
				else {
					// Use DataTransfer interface to access the file(s)
					for (var j = 0; i < dataTransfer.files.length; j++) {
						files[j] = dataTransfer.files[j];
					}
				}

				this.files = files;
			},

			_fileChangeHandler: function(files) {
				this.fire('file-added-to-upload', files);
			}
		});
	</script>

</dom-module>
