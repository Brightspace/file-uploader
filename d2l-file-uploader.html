<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../d2l-colors/d2l-colors.html">

<dom-module id="d2l-file-uploader">

	<template>
		<style>
			#drop_zone {
				border: 2px dashed;
				border-radius: 6px;
				text-align: center;
				height: 9rem;
				width: 27rem;
				max-width: 27rem;
			}

			:host([file-drag-over]) #drop_zone {
        		color: var(--d2l-color-celestine);
				background-color: var(--d2l-color-celestine-light-1);
      		}

			#file_upload_icon {
				padding-top: 1.5rem;
				padding-bottom: 0.6rem;
			}

			:host([file-drag-over]) #file_upload_icon svg path {
				fill: var(--d2l-color-celestine);
			}
			
			d2l-icon#file_upload_icon {
				--d2l-icon-height: 3rem;
				--d2l-icon-width: 3rem;
			}

			#file_upload_input {
				/*width: 0.1px;
				height: 0.1px;*/
				opacity: 0;
				overflow: hidden;
				position: absolute;
				/*z-index: -1;*/
			}

			#browse_label {
				position: relative;
				overflow: hidden;
				padding-right: 0px;
				border: none;
				background: none;
				color: var(--d2l-color-celestine);
			}

			#browse_label:hover, #file_upload_input:focus + label {
				color: var(--d2l-color-celestuba);;
				text-decoration: underline;
			}
		</style>

		<div id="drop_zone" on-drop="_fileDropHandler" on-dragover="_fileDragOverHandler" on-dragleave="_fileDragLeaveHandler" on-dragend="_fileDragEndHandler">
			<div id="file_upload_icon">
				<svg width="78" height="78" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 78 78">
					<path fill="#565a5c" d="M54.76,36A3.992,3.992,0,0,1,51,38.639H42v36a3,3,0,0,1-6,0v-36H27a4,4,0,0,1-2.56-7.07l12-10a3.988,3.988,0,0,1,5.12,0l12,10A4.007,4.007,0,0,1,54.76,36Z"/>
					<path fill="#565a5c" d="M46,53.549a1.333,1.333,0,0,0,.49.09"/>
					<path fill="#565a5c" d="M46.5,50.639a1.386,1.386,0,0,0-.5.09"/>
					<path fill="#565a5c" d="M78,36.139a17.519,17.519,0,0,1-17.5,17.5c-.17,0-1.33,0-1.5-.02l-12.51.02a1.333,1.333,0,0,1-.49-.09,1.494,1.494,0,0,1,0-2.82,1.386,1.386,0,0,1,.5-.09h14a14.5,14.5,0,0,0,1.58-28.92c-.52-.05-1.05-.08-1.58-.08h-.35a1.49,1.49,0,0,1-1-.4,2.258,2.258,0,0,1-.542-1.074c-.138-.462-.306-.916-.478-1.365a20.484,20.484,0,0,0-38.26,0q-.21.54-.39,1.08a3.353,3.353,0,0,1-.53,1.26,1.542,1.542,0,0,1-1.12.5H17.5c-.53,0-1.06.03-1.58.08a14.5,14.5,0,0,0,1.58,28.92H31.49a1.5,1.5,0,0,1,.01,3s-13.5,0-13.5-.02a4.176,4.176,0,0,1-.5.02,17.5,17.5,0,0,1-.77-34.98,23.489,23.489,0,0,1,44.54,0A17.519,17.519,0,0,1,78,36.139Z"/>
				</svg>
			</div>
			<div>
				<span>Drag and drop <span hidden$="[[multiple]]">a file</span><span hidden$="[[!multiple]]">files</span> anywhere on this screen or 
				<input id="file_upload_input" type="file" multiple="[[multiple]]" on-change="_fileSelectHandler"/>
				<label id="browse_label" for="file_upload_input">browse</label></span>
			</div>
		</div>
	</template>

	<script>
		Polymer({
			is: 'd2l-file-uploader',

			properties: {

				multiple: {
					type: Boolean,
					value: false,
					notify: false
				},

				files: {
					type: Object,
					notify: false,
					observer: '_fileChangeHandler'
				},

				fileDragOver: {
					type: Boolean,
					value: false,
					notify: false,
					reflectToAttribute: true
				}

			},

			_fileSelectHandler: function(event) {
				var files = [];
				for (var i = 0; i < event.target.files.length; i++) {
					files[i] = event.target.files[i];
				}

				this.files = files;
			},

			_fileDragOverHandler: function(event) {
				event.preventDefault();
				this.fileDragOver = true;
			},

			_fileDragLeaveHandler: function(event) {
				event.preventDefault();
				this.fileDragOver = false;
			},

			_fileDragEndHandler: function(event) {
				this.fileDragOver = false;
				var dataTransfer = event.dataTransfer;
				if (dataTransfer.items) {
					// Use DataTransferItemList interface to remove the drag data
					for (var i = 0; i < dataTransfer.items.length; i++) {
						dataTransfer.items.remove(i);
					}
				}
				else {
					// Use DataTransfer interface to remove the drag data
					event.dataTransfer.clearData();
				}
			},

			_fileDropHandler: function(event) {
				event.preventDefault();
				this.fileDragOver = false;
				var files = [];
				var dataTransfer = event.dataTransfer;
				if (dataTransfer.items) {
					// Use DataTransferItemList interface to access the file(s)
					if (this.multiple) {
						for (var i = 0; i < dataTransfer.items.length; i++) {
							if (dataTransfer.items[ i ].kind === 'file') {
								files[i] = dataTransfer.items[i].getAsFile();
							}
						}
					}
					else {
						files[0] = dataTransfer.items[0].getAsFile();
					}
				}
				else {
					// Use DataTransfer interface to access the file(s)
					if (this.multiple) {
						for (var j = 0; i < dataTransfer.files.length; j++) {
							files[j] = dataTransfer.files[j];
						}
					}
					else {
						files[0] = dataTransfer.files[0];
					}
				}

				this.files = files;
			},

			_fileChangeHandler: function(files) {
				this.fire('file-added-to-upload', files);
			}
		});
	</script>

</dom-module>
